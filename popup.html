<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<div class="menu pmd-floating-action" role="navigation">
    <a class="btn popover-html pmd-btn-fab pmd-btn-raised pmd-ripple-effect  btn-primary" data-trigger="click" data-toggle="popover"
        data-placement="top" data-html="true" href="javascript:void(0);"> 
            <span class="pmd-floating-hidden">Primary</span>
            <i class="material-icons md-light pmd-sm">chat</i>
        </a>
</div>



<script>
    var today = Math.round((new Date()).getTime() / 1000);
    var searchQuery = Cookies.get('searches');
    if (!searchQuery) {
        let searchObj = [];
        Cookies.set('searches', JSON.stringify(searchObj))
    }
    function getURLParameter(name) {
        return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
    }
    var clickstatus;

    let url = new URL(window.location.href);
    let params = getURLParameter('query');
    let update = getURLParameter('update');

    if (params) {
        $('[data-toggle="popover"]').popover();
        let searchV = JSON.parse(Cookies.get('searches'));
        let searchIndex = searchV.findIndex((value) => {
            return value.search == params
        })

        if (update !== 'no' || !update) {
            if ((searchIndex == -1 || searchIndex == undefined)) {
                let objSearch = {};
                objSearch["search"] = params;
                objSearch["count"] = 1;
                objSearch["date"] = today
                searchV.push(objSearch);
                Cookies.set('searches', JSON.stringify(searchV))

            }
            else {
                let getSearches = JSON.parse(Cookies.get('searches'))
                getSearches[searchIndex]["count"] = getSearches[searchIndex]["count"] + 1
                getSearches[searchIndex]["date"] = today;
                Cookies.set('searches', JSON.stringify(getSearches))

            }
        }
        $("div[role='navigation'] a").attr("data-content", `<iframe    src='http://localhost:9000/?popup=1&search=${params}' height='530' width='300' style='border:none'></iframe>`)
    }
    function triggerPopupHTML() {
        let popupHTML = $(value.contentDocument).find('body div.chat-body ul#msg_container');
        if (!popupHTML) {
            triggerSetInterval()
        }

    }



    function triggerSetInterval() {
        intervals = setInterval(() => {
            let popoverHtml = $("a.popover-html");
            // console.log(popoverHtml.next("div.popover").html() && clickstatus);
            if (clickstatus) {

                // clearInterval(intervals);
            } else {
                popoverHtml.popover('show');
                clickstatus = true;
                // clearInterval(intervals);
            }
        }, 10000)
        return intervals;
    }
    $(function () {
        intervals = triggerSetInterval();
        $("a.popover-html").click(function () {
            $("div[role='navigation'] a").attr("data-content", `<iframe    src='https://optychatbot.herokuapp.com/?popup=1&search=' height='530' width='300' style='border:none'></iframe>`)

        })
    })

</script>
<script>

</script>